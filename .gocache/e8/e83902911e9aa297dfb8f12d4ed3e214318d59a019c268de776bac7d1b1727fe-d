// Code generated by cmd/cgo; DO NOT EDIT.

//line /Users/hujiayilu/go/pkg/mod/github.com/shirou/gopsutil/v3@v3.23.10/mem/mem_darwin_cgo.go:1:1
//go:build darwin && cgo
// +build darwin,cgo

package mem

/*
#include <mach/mach_host.h>
#include <mach/vm_page_size.h>
*/
import _ "unsafe"

import (
	"context"
	"fmt"
	"unsafe"
)

// VirtualMemory returns VirtualmemoryStat.
func VirtualMemory() (*VirtualMemoryStat, error) {
	return VirtualMemoryWithContext(context.Background())
}

func VirtualMemoryWithContext(ctx context.Context) (*VirtualMemoryStat, error) {
	count :=  /*line :24:11*/_Ctype_mach_msg_type_number_t /*line :24:35*/(( /*line :24:36*/_Ciconst_HOST_VM_INFO_COUNT /*line :24:55*/))
	var vmstat  /*line :25:13*/_Ctype_vm_statistics_data_t /*line :25:35*/

	status := ( /*line :27:12*/_Cfunc_host_statistics /*line :27:28*/)( /*line :27:30*/_Ctype_host_t /*line :27:38*/(( /*line :27:39*/_Cfunc_mach_host_self /*line :27:54*/)()),
		( /*line :28:3*/_Ciconst_HOST_VM_INFO /*line :28:16*/),
		 /*line :29:3*/_Ctype_host_info_t /*line :29:16*/(unsafe.Pointer(&vmstat)),
		&count)

	if status != ( /*line :32:15*/_Ciconst_KERN_SUCCESS /*line :32:28*/) {
		return nil, fmt.Errorf("host_statistics error=%d", status)
	}

	pageSize := uint64(( /*line :36:21*/*_Cvar_vm_kernel_page_size /*line :36:41*/))
	total, err := getHwMemsize()
	if err != nil {
		return nil, err
	}
	totalCount :=  /*line :41:16*/_Ctype_natural_t /*line :41:27*/(total / pageSize)

	availableCount := vmstat.inactive_count + vmstat.free_count
	usedPercent := 100 * float64(totalCount-availableCount) / float64(totalCount)

	usedCount := totalCount - availableCount

	return &VirtualMemoryStat{
		Total:       total,
		Available:   pageSize * uint64(availableCount),
		Used:        pageSize * uint64(usedCount),
		UsedPercent: usedPercent,
		Free:        pageSize * uint64(vmstat.free_count),
		Active:      pageSize * uint64(vmstat.active_count),
		Inactive:    pageSize * uint64(vmstat.inactive_count),
		Wired:       pageSize * uint64(vmstat.wire_count),
	}, nil
}
